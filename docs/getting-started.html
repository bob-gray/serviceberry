<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Getting Started · Serviceberry</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Getting Started · Serviceberry"/><meta property="og:type" content="website"/><meta property="og:url" content="https://bob-gray.github.io/serviceberry/index.html"/><meta property="og:description" content="This guide will walk you through a creating a simple HTTP service with Serviceberry."/><link rel="shortcut icon" href="/serviceberry/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css"/><link rel="alternate" type="application/atom+xml" href="https://bob-gray.github.io/blog/atom.xml" title="Serviceberry Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://bob-gray.github.io/blog/feed.xml" title="Serviceberry Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/serviceberry/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/serviceberry/"><img class="logo" src="/serviceberry/img/serviceberry-horizontal.svg"/><h2 class="headerTitle">Serviceberry</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/serviceberry/docs/getting-started.html" target="_self">Guides</a></li><li><a href="/serviceberry/docs/serviceberry.html" target="_self">API Reference</a></li><li><a href="/serviceberry/blog" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/serviceberry/docs/getting-started.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/serviceberry/docs/handlers.html">Handlers</a></li><li class="navListItem"><a class="navItem" href="/serviceberry/docs/plugins.html">Plugins</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/serviceberry/docs/serviceberry.html">Serviceberry</a></li><li class="navListItem"><a class="navItem" href="/serviceberry/docs/trunk.html">Trunk</a></li><li class="navListItem"><a class="navItem" href="/serviceberry/docs/branch.html">Branch</a></li><li class="navListItem"><a class="navItem" href="/serviceberry/docs/leaf.html">Leaf</a></li><li class="navListItem"><a class="navItem" href="/serviceberry/docs/request.html">Request</a></li><li class="navListItem"><a class="navItem" href="/serviceberry/docs/response.html">Response</a></li><li class="navListItem"><a class="navItem" href="/serviceberry/docs/httperror.html">HttpError</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Getting Started</h1></header><article><div><span><p>This guide will walk you through a creating a simple HTTP service with Serviceberry.</p>
<h2><a class="anchor" aria-hidden="true" name="install-nodejs-and-serviceberry"></a><a href="#install-nodejs-and-serviceberry" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Install Node.js and Serviceberry</h2>
<p>Serviceberry is a framework for <a href="https://nodejs.org">Node.js</a>. If you don't have Node.js installed
visit the Node.js <a href="https://nodejs.org">website</a> to download and install the latest LTS version.</p>
<p>Once Node.js is installed we'll use npm (Node Package Manager) to install Serviceberry.
Create a folder (any name) and from within the folder run <code>npm install serviceberry</code>.</p>
<h2><a class="anchor" aria-hidden="true" name="hello-world"></a><a href="#hello-world" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hello World!</h2>
<p>From within the folder you installed Serviceberry create a new file named <code>hello.js</code> and copy the line of
JavaScript below into it.</p>
<pre><code class="hljs css javascript"><span class="hljs-built_in">require</span>(<span class="hljs-string">"serviceberry"</span>).createTrunk().on(<span class="hljs-string">"*"</span>, () =&gt; <span class="hljs-string">"Hello World!"</span>);
</code></pre>
<p>Now run <code>node hello</code> to start your service and visit <a href="http://localhost:3000">http://localhost:3000</a>
to see the response.</p>
<h2><a class="anchor" aria-hidden="true" name="hello-world-version-2"></a><a href="#hello-world-version-2" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Hello World! (version 2)</h2>
<p>Becuase we want to build services that are much more interesting and powerful than <code>hello.js</code> above,
next we'll break down what is happening by refactoring. Then we'll a some new features.</p>
<p>The first expression is loading <a href="serviceberry.html">Serviceberry</a>. We'll assign it in a variable for use next.</p>
<pre><code class="hljs css javascript"><span class="hljs-keyword">const</span> serviceberry = <span class="hljs-built_in">require</span>(<span class="hljs-string">"serviceberry"</span>);
</code></pre>
<p>The next expression creates the service <a href="trunk.html">trunk</a>. The trunk is the entry point of the framework
and the incoming requests. All branches and leaves originate at the trunk. Because it is the root path we'll
assign the trunk to a variable named <code>service</code>.</p>
<pre><code class="hljs css javascript"><span class="hljs-keyword">const</span> service = serviceberry.createTrunk();
</code></pre>
<p>For now we won't pass any arguments and just use the default options.</p>
<p>The last expression adds a handler for all methods to the root path of the service which in our case
will be <a href="http://localhost:3000">http://localhost:3000</a>.</p>
<pre><code class="hljs css javascript">service.on(<span class="hljs-string">"*"</span>, () =&gt; <span class="hljs-string">"Hello World!"</span>);
</code></pre>
<h3><a class="anchor" aria-hidden="true" name="feature-1-custom-greetings"></a><a href="#feature-1-custom-greetings" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Feature 1: <em>Custom Greetings</em></h3>
<p>Lets greet a user by name using a parameter in the URL path. The service should response to <code>GET /hello/{name}</code>
with <code>Hello {name}!</code>.</p>
<p>To do this we'll add a new branch with <code>at()</code> and switch from <code>*</code> to <code>GET</code>. Our path to the new branch will
include the placeholder for <code>{name}</code>. Serviceberry will parse this path parameter out of the URL when routing
the request. The value of the parameter will be available through the methods of the <code>request</code> object passed
to our hanlder.</p>
<pre><code class="hljs css javascript">service.at(<span class="hljs-string">"hello/{name}"</span>)
    .on(<span class="hljs-string">"GET"</span>, request =&gt; <span class="hljs-string">`Hello <span class="hljs-subst">${request.getParam(<span class="hljs-string">"name"</span>)}</span>!`</span>);
</code></pre>
<p>Now <code>hello.js</code> should look like this.</p>
<pre><code class="hljs css javascript"><span class="hljs-keyword">const</span> serviceberry = <span class="hljs-built_in">require</span>(<span class="hljs-string">"serviceberry"</span>);
<span class="hljs-keyword">const</span> service = serviceberry.createTrunk();

service.at(<span class="hljs-string">"hello/{name}"</span>)
    .on(<span class="hljs-string">"GET"</span>, request =&gt; <span class="hljs-string">`Hello <span class="hljs-subst">${request.getParam(<span class="hljs-string">"name"</span>)}</span>!`</span>);
</code></pre>
<p>Now run <code>node hello</code> to start your service and visit <a href="http://localhost:3000/hello/Bob">http://localhost:3000/hello/Bob</a>
to see the response.</p>
<h3><a class="anchor" aria-hidden="true" name="feature-2-respond-with-json"></a><a href="#feature-2-respond-with-json" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Feature 2: <em>Respond with JSON</em></h3>
<p>Now lets send our response serialized as a JSON object.</p>
<p>To do this we'll use a options object instead of <code>&quot;GET&quot;</code> when adding our handler <code>on()</code> and we'll return and object
from our handler instead of a string. Serviceberry has built in support for JSON request and response body content
type and form encoded request body content type.</p>
<pre><code class="hljs css javascript">service.at(<span class="hljs-string">"hello/{name}"</span>).on({
    <span class="hljs-attr">method</span>: <span class="hljs-string">"GET"</span>,
    <span class="hljs-attr">produces</span>: <span class="hljs-string">"application/json"</span>
}, request =&gt; ({
    <span class="hljs-attr">greeting</span>: <span class="hljs-string">`Hello <span class="hljs-subst">${request.getParam(<span class="hljs-string">"name"</span>)}</span>!`</span>
}));
</code></pre>
<p>Now <code>hello.js</code> should look like this.</p>
<pre><code class="hljs css javascript"><span class="hljs-keyword">const</span> serviceberry = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../src/main"</span>);
<span class="hljs-keyword">const</span> service = serviceberry.createTrunk();

service.at(<span class="hljs-string">"hello/{name}"</span>).on({
    <span class="hljs-attr">method</span>: <span class="hljs-string">"GET"</span>,
    <span class="hljs-attr">produces</span>: <span class="hljs-string">"application/json"</span>
}, request =&gt; ({
    <span class="hljs-attr">greeting</span>: <span class="hljs-string">`Hello <span class="hljs-subst">${request.getParam(<span class="hljs-string">"name"</span>)}</span>!`</span>
}));
</code></pre>
<p>Now run <code>node hello</code> to start your service and visit <a href="http://localhost:3000/hello/Bob">http://localhost:3000/hello/Bob</a>
to see the response.</p>
<h3><a class="anchor" aria-hidden="true" name="feature-3-token-authentication"></a><a href="#feature-3-token-authentication" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Feature 3: <em>Token Authentication</em></h3>
<p>Once our service becomes popular we'll need to secure it so we can make sure only our users
can access it. To do this we'll add a simple plugin handler to validate sent as a query string
parameter.</p>
<p>Save <code>d0189daeb2097</code> to <code>token.txt</code> within your service folder. To validate the token in the
query string we'll read the token from <code>token.txt</code>. Since we don't want our service to wait
while the file is read we'll read the file asynchronously and call <code>request.proceed()</code> when the
request is authenticated and <code>request.fail(error[, status])</code> when the token is missing or invalid.</p>
<pre><code class="hljs css javascript"><span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> service = serviceberry.createTrunk().use(authenticate);

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authenticate</span> (<span class="hljs-params">request</span>) </span>{
    <span class="hljs-keyword">const</span> token = request.getParam(<span class="hljs-string">"token"</span>);

    <span class="hljs-keyword">if</span> (!token) {
        request.fail(<span class="hljs-string">"Token required!"</span>, <span class="hljs-number">401</span>);
    }

    fs.readFile(<span class="hljs-string">"token.txt"</span>, <span class="hljs-string">"utf8"</span>, (error, secret) =&gt; {
        <span class="hljs-keyword">if</span> (error) {
            request.fail(error);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (token !== secret.trim()) {
            request.fail(<span class="hljs-string">"Token is not valid!"</span>, <span class="hljs-number">403</span>);
        } <span class="hljs-keyword">else</span> {
            request.proceed();
        }
    });
}

</code></pre>
<p>Now <code>hello.js</code> should look like this.</p>
<pre><code class="hljs css javascript"><span class="hljs-keyword">const</span> serviceberry = <span class="hljs-built_in">require</span>(<span class="hljs-string">"../src/main"</span>);
<span class="hljs-keyword">const</span> fs = <span class="hljs-built_in">require</span>(<span class="hljs-string">"fs"</span>);
<span class="hljs-keyword">const</span> service = serviceberry.createTrunk().use(authenticate);

service.at(<span class="hljs-string">"hello/{name}"</span>).on({
    <span class="hljs-attr">method</span>: <span class="hljs-string">"GET"</span>,
    <span class="hljs-attr">produces</span>: <span class="hljs-string">"application/json"</span>
}, request =&gt; ({
    <span class="hljs-attr">greeting</span>: <span class="hljs-string">`Hello <span class="hljs-subst">${request.getParam(<span class="hljs-string">"name"</span>)}</span>!`</span>
}));

<span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">authenticate</span> (<span class="hljs-params">request</span>) </span>{
    <span class="hljs-keyword">const</span> token = request.getParam(<span class="hljs-string">"token"</span>);

    <span class="hljs-keyword">if</span> (!token) {
        request.fail(<span class="hljs-string">"Token required!"</span>, <span class="hljs-number">401</span>);
    }

    fs.readFile(<span class="hljs-string">"token.txt"</span>, <span class="hljs-string">"utf8"</span>, (error, secret) =&gt; {
        <span class="hljs-keyword">if</span> (error) {
            request.fail(error);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (token !== secret.trim()) {
            request.fail(<span class="hljs-string">"Token is not valid!"</span>, <span class="hljs-number">403</span>);
        } <span class="hljs-keyword">else</span> {
            request.proceed();
        }
    });
}
</code></pre>
<p>Now run <code>node hello</code> to start your service and visit <a href="http://localhost:3000/hello/bob?token=d0189daeb2097">http://localhost:3000/hello/bob?token=d0189daeb2097</a>
to see the response. Try it without the token and with a bad token to see the fail repsonse.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-next button" href="handlers.html">Handlers →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/serviceberry/" class="nav-home"></a><div><h5>Guides</h5><a href="/serviceberry/docs/en/getting-started.html">Getting Started</a></div><div><h5>API Reference</h5><a href="/serviceberry/docs/en/serviceberry.html">Serviceberry</a><a href="/serviceberry/docs/en/handler.html">Handler</a><a href="/serviceberry/docs/en/trunk.html">Trunk</a><a href="/serviceberry/docs/en/branch.html">Branch</a><a href="/serviceberry/docs/en/leaf.html">Leaf</a><a href="/serviceberry/docs/en/request.html">Reqeust</a><a href="/serviceberry/docs/en/response.html">Response</a><a href="/serviceberry/docs/en/http-error.html">HttpError</a></div><div><h5>More</h5><a href="/serviceberry/blog">Blog</a><a href="https://github.com/bob-gray/serviceberry">GitHub</a><a class="github-button" href="https://github.com/bob-gray/serviceberry" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section></footer></div></body></html>