<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Handlers · Serviceberry</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Handlers · Serviceberry"/><meta property="og:type" content="website"/><meta property="og:url" content="https://serviceberry.js.org/index.html"/><meta property="og:description" content="Understanding handlers is central to creating a service using Serviceberry. All things that"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css"/><link rel="alternate" type="application/atom+xml" href="https://serviceberry.js.org/blog/atom.xml" title="Serviceberry Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://serviceberry.js.org/blog/feed.xml" title="Serviceberry Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/serviceberry-horizontal.svg"/><h2 class="headerTitle">Serviceberry</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/docs/getting-started.html" target="_self">Guides</a></li><li><a href="/docs/serviceberry.html" target="_self">API Reference</a></li><li><a href="/blog" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/docs/getting-started.html">Getting Started</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/handlers.html">Handlers</a></li><li class="navListItem"><a class="navItem" href="/docs/plugins.html">Plugins</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/docs/serviceberry.html">Serviceberry</a></li><li class="navListItem"><a class="navItem" href="/docs/trunk.html">Trunk</a></li><li class="navListItem"><a class="navItem" href="/docs/branch.html">Branch</a></li><li class="navListItem"><a class="navItem" href="/docs/leaf.html">Leaf</a></li><li class="navListItem"><a class="navItem" href="/docs/request.html">Request</a></li><li class="navListItem"><a class="navItem" href="/docs/response.html">Response</a></li><li class="navListItem"><a class="navItem" href="/docs/httperror.html">HttpError</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Handlers</h1></header><article><div><span><p>Understanding handlers is central to creating a service using Serviceberry. All things that
interact with service requests do so through a common handler API. This means
serializers, deserialiers, plugins and endpoint are all created in the same way.</p>
<p>A handlers can be a function or an object that has a <code>use</code> method that is a handler function. Handler
functions all have the same signature <code>(request, response)</code>. Request and response are wrapper objects
for the <a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_class_http_incomingmessage"><em>http.IncomingRequest</em></a>
and <a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_class_http_serverresponse"><em>http.ServiceResponse</em></a>
arguments passed to the underlining <a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_class_http_server"><em>http.Server</em></a>
&quot;request&quot; event listener.</p>
<h2><a class="anchor" aria-hidden="true" name="handler-function"></a><a href="#handler-function" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handler Function</h2>
<ul>
<li>request <em>object</em></li>
<li>response <em>object</em></li>
</ul>
<p>Handler functions are added to your service's nodes when defining the service. Then Serviceberry
routes each request through your service and builds a queue of handlers. Each handler in the queue is
then called one after the other. Each given control of the request and response until control is
passed to the next handler. Handlers communicate control decisions to Serviceberry through their
return value or by throwing an error.</p>
<ol>
<li>Return a <code>promise</code> (any thennable should work).</li>
<li>Return something other than <code>false</code> that is not thennable.</li>
<li>Return nothing and call <code>request.proceed()</code>.</li>
<li>Return nothing and call <code>response.send(options)</code>.</li>
<li>Return nothing and call <code>request.fail(error)</code>.</li>
<li>Return <code>false</code>.</li>
<li>Throw an <code>error</code>.</li>
</ol>
<p>These action will result in one of three possible outcomes. Each handler has exactly one opportunity to exercise control.
Once action has been taken, control is transferred away from the handler.</p>
<ol>
<li>Proceed with the request (typical for a plugin).</li>
<li>Complete the request and send a response to the client (typical for endpoint implementation).</li>
<li>Failure encountered - fallback to a catch.</li>
</ol>
<p>Throwing an <code>error</code>, returning <code>false</code>, returning a rejected <code>promise</code> or calling <code>response.fail(error)</code> are
all functionally equivalent. They will all result in control falling back to the nearest catch handler. Errors are
available in catch handers as <code>request.error</code>. If no catch handler is found the request will be ended.</p>
<p>Returning a resolved <code>promise</code>, returning anything other than <code>false</code> or a thennable, or calling <code>request.proceed()</code> are
all functionally equivalent. They will all result in handing control to the next handler in the queue.</p>
<p>Calling <code>response.send(options)</code> will complete the request and send the response to the client.</p>
<p><code>request.proceed()</code>, <code>request.fail(error)</code> and <code>response.send(options)</code> are not required to be called with context so
they can safely be passed as callbacks - such as <code>.then(request.proceed, request.fail)</code>. Once control is handed to the
next handler, these request and response methods given to the prior handler are rendered useless.</p>
<h2><a class="anchor" aria-hidden="true" name="handler-object"></a><a href="#handler-object" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handler Object</h2>
<p>Everywhere a handler is accepted as an argument, an object having a <code>use</code> method that is a handler function can passed.
When Serviceberry is passed a handler object it binds the object's <code>use</code> method to the object so that handlers
can easily be stateful. This plugins can be implemented as classes that are instanced and configured then passed
as handlers to Serviceberry.</p>
<pre><code class="hljs css javascript"><span class="hljs-comment">// AuthPlugin, key and service all defined above</span>

<span class="hljs-keyword">const</span> auth = <span class="hljs-keyword">new</span> AuthPlugin({key, <span class="hljs-attr">scheme</span>: <span class="hljs-string">"bearer"</span>});

service.use(auth);
</code></pre>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="getting-started.html">← Getting Started</a><a class="docs-next button" href="plugins.html">Plugins →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Guides</h5><a href="/docs/en/getting-started.html">Getting Started</a></div><div><h5>API Reference</h5><a href="/docs/en/serviceberry.html">Serviceberry</a><a href="/docs/en/handler.html">Handler</a><a href="/docs/en/trunk.html">Trunk</a><a href="/docs/en/branch.html">Branch</a><a href="/docs/en/leaf.html">Leaf</a><a href="/docs/en/request.html">Reqeust</a><a href="/docs/en/response.html">Response</a><a href="/docs/en/http-error.html">HttpError</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/bob-gray/serviceberry">GitHub</a><a class="github-button" href="https://github.com/bob-gray/serviceberry" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section></footer></div></body></html>