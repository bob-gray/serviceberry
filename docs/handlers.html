<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Handlers · Serviceberry</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Handlers · Serviceberry"/><meta property="og:type" content="website"/><meta property="og:url" content="https://serviceberry.js.org/index.html"/><meta property="og:description" content="Understanding handlers is central to creating a service using Serviceberry. All things that"/><meta property="og:image" content="https://serviceberry.js.org/img/serviceberry.svg"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css"/><link rel="alternate" type="application/atom+xml" href="https://serviceberry.js.org/blog/atom.xml" title="Serviceberry Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://serviceberry.js.org/blog/feed.xml" title="Serviceberry Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible doc separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/serviceberry-horizontal.svg"/><h2 class="headerTitle">Serviceberry</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/getting-started.html" target="_self">Guides</a></li><li class="siteNavGroupActive"><a href="/docs/serviceberry.html" target="_self">API Reference</a></li><li class=""><a href="/blog" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/docs/getting-started.html">Getting Started</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/handlers.html">Handlers</a></li><li class="navListItem"><a class="navItem" href="/docs/plugins.html">Plugins</a></li><li class="navListItem"><a class="navItem" href="/docs/auto-responses.html">Auto Responses</a></li><li class="navListItem"><a class="navItem" href="/docs/how-it-works.html">How It Works</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/docs/serviceberry.html">Serviceberry</a></li><li class="navListItem"><a class="navItem" href="/docs/trunk.html">Trunk</a></li><li class="navListItem"><a class="navItem" href="/docs/branch.html">Branch</a></li><li class="navListItem"><a class="navItem" href="/docs/leaf.html">Leaf</a></li><li class="navListItem"><a class="navItem" href="/docs/request.html">Request</a></li><li class="navListItem"><a class="navItem" href="/docs/response.html">Response</a></li><li class="navListItem"><a class="navItem" href="/docs/httperror.html">HttpError</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Handlers</h1></header><article><div><span><p>Understanding handlers is central to creating a service using Serviceberry. All things that
interact with service requests do so through a common handler API. This means your endpoints,
plugins, catches, serializers and deserializers are all created in the same way.</p>
<p>A handler can be a <a href="#handler-function">function</a> or an <a href="#handler-object">object</a>. Handler objects
can be any object with a <code>use</code> method that is a handler function.</p>
<h2><a class="anchor" aria-hidden="true" id="handler-functions"></a><a href="#handler-functions" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handler Functions</h2>
<p>Handler functions all have the same arguments signature <code>(request, response)</code>.
<a href="request.html">Request</a> and <a href="response.html">response</a> are wrapper objects for the
<a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_class_http_incomingmessage">http.IncomingRequest</a>
and <a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_class_http_serverresponse">http.ServiceResponse</a>
arguments passed to the underlining <a href="https://nodejs.org/dist/latest-v8.x/docs/api/http.html#http_class_http_server">http.Server</a>
<code>request</code> event listener.</p>
<ul>
<li><a href="request.html">request</a> <em>object</em></li>
<li><a href="response.html">response</a> <em>object</em></li>
</ul>
<p>Handlers are added to the <a href="trunk.html">trunk</a>, <a href="branch.html">branches</a> and <a href="leaf.html">leaves</a>
of your service using Serviceberry's API. When Serviceberry routes each request through your service, it builds a queue of handlers. Each handler in the queue is then called one after the other. Each given control of the
request and response until control is passed to the next handler. Handlers exercise control through
their return value or by throwing an error.</p>
<h3><a class="anchor" aria-hidden="true" id="three-possible-outcomes"></a><a href="#three-possible-outcomes" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Three Possible Outcomes</h3>
<p>Each handler has exactly one opportunity to exercise control. Once action has been taken, control
is transferred away from the handler. There are three possible outcomes.</p>
<ol>
<li>Proceed with the request (typical for a plugin).</li>
<li>Complete the request and send a response to the client (typical for an endpoint).</li>
<li>Fallback to the nearest catch.</li>
</ol>
<h3><a class="anchor" aria-hidden="true" id="controlling-the-outcome"></a><a href="#controlling-the-outcome" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Controlling the Outcome</h3>
<p>Which outcome occurs depends primarily on the value returned from the handler. The handler can exercise
control over the request and response by the following actions.</p>
<ol>
<li>Return a <a href="https://developer.mozilla.org/docs/Web/JavaScript/Reference/Global_Objects/Promise"><code>promise</code></a>
(any thennable should work).</li>
<li>Return something other than <code>false</code> that is not thennable.</li>
<li>Return nothing and call <a href="request.html#proceedvalue"><code>request.proceed()</code></a>.</li>
<li>Return nothing and call <a href="response.html#sendoptions"><code>response.send()</code></a>.</li>
<li>Return nothing and call <a href="request.html#failerror-status-headers"><code>request.fail()</code></a>.</li>
<li>Return <code>false</code>.</li>
<li>Throw an error.</li>
</ol>
<p>Returning a <code>promise</code> that is resolved or eventually resolved, returning anything other than <code>false</code> or a
thennable, or returning nothing and calling <code>request.proceed()</code> are all functionally equivalent. They all result in the request
proceeding. Control will be given to the next handler in the queue. If the queue has no more handlers,
the request will end.</p>
<p>Returning nothing and calling <code>response.send()</code> will complete the request and send the response to the client.</p>
<p>Returning a <code>promise</code> that is rejected or eventually rejected, returning <code>false</code>, throwing an error, or returning
nothing and calling <code>response.fail()</code> are all functionally equivalent. They all result in control falling back to the nearest catch handler. If no catch handler is found the request will be ended. Errors are available in catch handlers
at <code>request.error</code>.</p>
<p><code>request.proceed()</code>, <code>request.fail()</code> and <code>response.send()</code> can all be called asynchronously as long
as the handler doesn't return a value. Additionally none are required to be called with context so
each can be safely passed directly as callbacks - such as <code>.then(request.proceed, request.fail)</code>. When control is handed to the
next handler, request and response methods given to the prior handler are rendered useless.</p>
<h2><a class="anchor" aria-hidden="true" id="handler-objects"></a><a href="#handler-objects" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Handler Objects</h2>
<p>Everywhere a handler is accepted as an argument, an object can be used. It can be any object that has a <code>use</code>
method that is a handler function. When Serviceberry is passed a handler object it binds the object's <code>use</code> method to the object so that handlers can be stateful. This can be particularly useful for plugins.</p>
<p>To learn about using and creating plugins, checkout the next guide.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="getting-started.html">← Getting Started</a><a class="docs-next button" href="plugins.html">Plugins →</a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#handler-functions">Handler Functions</a><ul class="toc-headings"><li><a href="#three-possible-outcomes">Three Possible Outcomes</a></li><li><a href="#controlling-the-outcome">Controlling the Outcome</a></li></ul></li><li><a href="#handler-objects">Handler Objects</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Guides</h5><a href="/docs/getting-started.html">Getting Started</a><a href="/docs/handlers.html">Handlers</a><a href="/docs/plugins.html">Plugins</a><a href="/docs/auto-responses.html">Auto Responses</a><a href="/docs/how-it-works.html">How it Works</a></div><div><h5>API Reference</h5><a href="/docs/serviceberry.html">Serviceberry</a><a href="/docs/trunk.html">Trunk</a><a href="/docs/branch.html">Branch</a><a href="/docs/leaf.html">Leaf</a><a href="/docs/request.html">Reqeust</a><a href="/docs/response.html">Response</a><a href="/docs/httperror.html">HttpError</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/bob-gray/serviceberry">GitHub</a><a class="github-button" href="https://github.com/bob-gray/serviceberry" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><a href="/docs/license.html">License</a></div></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
              var search = docsearch({
                
                apiKey: 'd8f71d3fca61a88437ddb93081120da2',
                indexName: 'serviceberry',
                inputSelector: '#search_input_react'
              });
            </script></body></html>