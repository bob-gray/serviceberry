<html lang="en"><head><meta charset="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Plugins · Serviceberry</title><meta name="viewport" content="width=device-width"/><meta name="generator" content="Docusaurus"/><meta property="og:title" content="Plugins · Serviceberry"/><meta property="og:type" content="website"/><meta property="og:url" content="https://serviceberry.js.org/index.html"/><meta property="og:description" content="This guide will walk you through creating using plugins a simple Serviceberry plugin."/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css"/><link rel="alternate" type="application/atom+xml" href="https://serviceberry.js.org/blog/atom.xml" title="Serviceberry Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://serviceberry.js.org/blog/feed.xml" title="Serviceberry Blog RSS Feed"/><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><link rel="stylesheet" href="/css/main.css"/></head><body class="sideNavVisible"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/serviceberry-horizontal.svg"/><h2 class="headerTitle">Serviceberry</h2></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li><a href="/docs/getting-started.html" target="_self">Guides</a></li><li><a href="/docs/serviceberry.html" target="_self">API Reference</a></li><li><a href="/blog" target="_self">Blog</a></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="container docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><i></i></div><h2><i>›</i><span>Guides</span></h2></div><div class="navGroups"><div class="navGroup navGroupActive"><h3>Guides</h3><ul><li class="navListItem"><a class="navItem" href="/docs/getting-started.html">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/handlers.html">Handlers</a></li><li class="navListItem navListItemActive"><a class="navItem navItemActive" href="/docs/plugins.html">Plugins</a></li></ul></div><div class="navGroup navGroupActive"><h3>API Reference</h3><ul><li class="navListItem"><a class="navItem" href="/docs/serviceberry.html">Serviceberry</a></li><li class="navListItem"><a class="navItem" href="/docs/trunk.html">Trunk</a></li><li class="navListItem"><a class="navItem" href="/docs/branch.html">Branch</a></li><li class="navListItem"><a class="navItem" href="/docs/leaf.html">Leaf</a></li><li class="navListItem"><a class="navItem" href="/docs/request.html">Request</a></li><li class="navListItem"><a class="navItem" href="/docs/response.html">Response</a></li><li class="navListItem"><a class="navItem" href="/docs/httperror.html">HttpError</a></li></ul></div></div></section></div><script>
          var toggler = document.getElementById('navToggler');
          var nav = document.getElementById('docsNav');
          toggler.onclick = function() {
            nav.classList.toggle('docsSliderActive');
          };
        </script></nav></div><div class="container mainContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1>Plugins</h1></header><article><div><span><p>This guide will walk you through creating using plugins a simple Serviceberry plugin.</p>
<h2><a class="anchor" aria-hidden="true" name="plugins-are-handlers"></a><a href="#plugins-are-handlers" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Plugins Are Handlers</h2>
<p>Plugins are handlers that are designed for reuse. <em>If you haven't read the <a href="handlers.html">Handlers</a>
guide you may want to back up and start there.</em> The great thing about plugins being handlers is
creating a plugin is no more difficult than creating a handler for your endpoint. To show you what
I mean, let's create a plugin.</p>
<h2><a class="anchor" aria-hidden="true" name="json-schema-plugin"></a><a href="#json-schema-plugin" aria-hidden="true" class="hash-link" ><svg aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>JSON Schema Plugin</h2>
<p>We'll create a plugin for validating the post request body with a <a href="http://json-schema.org/">JSON Schema</a>.
All the heavy lifting will be done by <a href="https://www.npmjs.com/package/jsonschema">jsonschema</a> - an npm package
that we'll install. Our plugin will just be a thin wrapper that responds with an appropriate error
when validation fails.</p>
<p>Create a folder. From within the folder run <code>npm install jsonschema</code>. Create a file named
<code>serviceberryJsonSchema.js</code>, save it in the folder and copy the JavaScript below into it.</p>
<pre><code class="hljs css javascript"><span class="hljs-keyword">const</span> validate = <span class="hljs-built_in">require</span>(<span class="hljs-string">"jsonschema"</span>).validate;
<span class="hljs-keyword">const</span> serviceberry = <span class="hljs-built_in">require</span>(<span class="hljs-string">"serviceberry"</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-params">schema</span> =&gt;</span> request =&gt; {
    <span class="hljs-keyword">const</span> result = validate(request.getBody(), schema);

    <span class="hljs-keyword">if</span> (result.valid) {
        request.proceed();
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> serviceberry.HttpError(result.errors, <span class="hljs-number">422</span>, {
            <span class="hljs-string">"Content-Type"</span>: <span class="hljs-string">"application/json"</span>
        });
    }
};
</code></pre>
<p>First our plugin requires <code>jsonschema</code> and assigns it's validate function to a variable. Then it exports a
function that accepts a schema and returns a handler function. The handler function will validate the request
body of each request that runs through it. The request proceeds if it's body is valid or fails if it's
body does not match the schema.</p>
<p>Let's create a simple service to use our plugin. Create a file named <code>echo.js</code>, save it in the
same folder as <code>serviceberryJsonSchema.js</code> and copy the JavaScript below into it.</p>
<pre><code class="hljs css javascript"><span class="hljs-keyword">const</span> serviceberry = <span class="hljs-built_in">require</span>(<span class="hljs-string">"serviceberry"</span>);
<span class="hljs-keyword">const</span> validate = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./serviceberryJsonSchema"</span>);
<span class="hljs-keyword">const</span> service = serviceberry.createTrunk();

service.at(<span class="hljs-string">"echo"</span>).on({
    <span class="hljs-attr">method</span>: <span class="hljs-string">"POST"</span>,
    <span class="hljs-attr">consumes</span>: <span class="hljs-string">"application/json"</span>,
    <span class="hljs-attr">produces</span>: <span class="hljs-string">"application/json"</span>
})
.use(validate({
    <span class="hljs-attr">type</span>: <span class="hljs-string">"object"</span>,
    <span class="hljs-attr">properties</span>: {
        <span class="hljs-attr">name</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span>,
            <span class="hljs-attr">minLength</span>: <span class="hljs-number">1</span>
        },
        <span class="hljs-attr">age</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"integer"</span>,
            <span class="hljs-attr">minimum</span>: <span class="hljs-number">0</span>
        },
        <span class="hljs-attr">email</span>: {
            <span class="hljs-attr">type</span>: <span class="hljs-string">"string"</span>
        }
    }
}))
.use(<span class="hljs-function"><span class="hljs-params">request</span> =&gt;</span> request.getBody());
</code></pre>
<p>Now run <code>node echo</code> to start your service and send a POST request to <a href="http://localhost:3000/echo">http://localhost:3000/echo</a> with a JSON body.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="handlers.html">← Handlers</a><a class="docs-next button" href="serviceberry.html">Serviceberry →</a></div></div></div></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Guides</h5><a href="/docs/en/getting-started.html">Getting Started</a></div><div><h5>API Reference</h5><a href="/docs/en/serviceberry.html">Serviceberry</a><a href="/docs/en/handler.html">Handler</a><a href="/docs/en/trunk.html">Trunk</a><a href="/docs/en/branch.html">Branch</a><a href="/docs/en/leaf.html">Leaf</a><a href="/docs/en/request.html">Reqeust</a><a href="/docs/en/response.html">Response</a><a href="/docs/en/http-error.html">HttpError</a></div><div><h5>More</h5><a href="/blog">Blog</a><a href="https://github.com/bob-gray/serviceberry">GitHub</a><a class="github-button" href="https://github.com/bob-gray/serviceberry" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a></div></section></footer></div></body></html>