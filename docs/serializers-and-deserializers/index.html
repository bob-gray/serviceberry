<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta http-equiv="X-UA-Compatible" content="IE=edge"/><title>Serializers and Deserializers · Serviceberry</title><meta name="viewport" content="width=device-width, initial-scale=1.0"/><meta name="generator" content="Docusaurus"/><meta name="description" content="Serializers and deserializers are [handlers](handers) but they have a specific mission. Serializers transform the "/><meta name="docsearch:language" content="en"/><meta property="og:title" content="Serializers and Deserializers · Serviceberry"/><meta property="og:type" content="website"/><meta property="og:url" content="https://serviceberry.js.org/"/><meta property="og:description" content="Serializers and deserializers are [handlers](handers) but they have a specific mission. Serializers transform the "/><meta property="og:image" content="https://serviceberry.js.org/img/serviceberry.svg"/><meta name="twitter:card" content="summary"/><link rel="shortcut icon" href="/img/favicon.ico"/><link rel="stylesheet" href="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.css"/><link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/agate.min.css"/><link rel="alternate" type="application/atom+xml" href="https://serviceberry.js.org/blog/atom.xml" title="Serviceberry Blog ATOM Feed"/><link rel="alternate" type="application/rss+xml" href="https://serviceberry.js.org/blog/feed.xml" title="Serviceberry Blog RSS Feed"/><script>
              (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
              (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
              m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
              })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

              ga('create', 'UA-116036661-1', 'auto');
              ga('send', 'pageview');
            </script><script type="text/javascript" src="https://buttons.github.io/buttons.js"></script><script src="/js/scrollSpy.js"></script><link rel="stylesheet" href="/css/main.css"/><script src="/js/codetabs.js"></script></head><body class="sideNavVisible separateOnPageNav"><div class="fixedHeaderContainer"><div class="headerWrapper wrapper"><header><a href="/"><img class="logo" src="/img/serviceberry-horizontal.svg" alt="Serviceberry"/></a><div class="navigationWrapper navigationSlider"><nav class="slidingNav"><ul class="nav-site nav-site-internal"><li class="siteNavGroupActive"><a href="/docs/getting-started" target="_self">Guides</a></li><li class="siteNavGroupActive"><a href="/docs/serviceberry" target="_self">API Reference</a></li><li class=""><a href="/blog/" target="_self">Blog</a></li><li class="navSearchWrapper reactNavSearchWrapper"><input type="text" id="search_input_react" placeholder="Search" title="Search"/></li></ul></nav></div></header></div></div><div class="navPusher"><div class="docMainWrapper wrapper"><div class="docsNavContainer" id="docsNav"><nav class="toc"><div class="toggleNav"><section class="navWrapper wrapper"><div class="navBreadcrumb wrapper"><div class="navToggle" id="navToggler"><div class="hamburger-menu"><div class="line1"></div><div class="line2"></div><div class="line3"></div></div></div><h2><i>›</i><span>Guides</span></h2><div class="tocToggler" id="tocToggler"><i class="icon-toc"></i></div></div><div class="navGroups"><div class="navGroup"><h3 class="navGroupCategoryTitle">Guides</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/getting-started">Getting Started</a></li><li class="navListItem"><a class="navItem" href="/docs/handlers">Handlers</a></li><li class="navListItem"><a class="navItem" href="/docs/plugins">Plugins</a></li><li class="navListItem navListItemActive"><a class="navItem" href="/docs/serializers-and-deserializers">Serializers and Deserializers</a></li><li class="navListItem"><a class="navItem" href="/docs/service-tree">Service Tree</a></li><li class="navListItem"><a class="navItem" href="/docs/auto-responses">Auto Responses</a></li><li class="navListItem"><a class="navItem" href="/docs/how-it-works">How It Works</a></li></ul></div><div class="navGroup"><h3 class="navGroupCategoryTitle">API Reference</h3><ul class=""><li class="navListItem"><a class="navItem" href="/docs/serviceberry">Serviceberry</a></li><li class="navListItem"><a class="navItem" href="/docs/trunk">Trunk</a></li><li class="navListItem"><a class="navItem" href="/docs/branch">Branch</a></li><li class="navListItem"><a class="navItem" href="/docs/leaf">Leaf</a></li><li class="navListItem"><a class="navItem" href="/docs/request">Request</a></li><li class="navListItem"><a class="navItem" href="/docs/response">Response</a></li><li class="navListItem"><a class="navItem" href="/docs/httperror">HttpError</a></li></ul></div></div></section></div><script>
            var coll = document.getElementsByClassName('collapsible');
            var checkActiveCategory = true;
            for (var i = 0; i < coll.length; i++) {
              var links = coll[i].nextElementSibling.getElementsByTagName('*');
              if (checkActiveCategory){
                for (var j = 0; j < links.length; j++) {
                  if (links[j].classList.contains('navListItemActive')){
                    coll[i].nextElementSibling.classList.toggle('hide');
                    coll[i].childNodes[1].classList.toggle('rotate');
                    checkActiveCategory = false;
                    break;
                  }
                }
              }

              coll[i].addEventListener('click', function() {
                var arrow = this.childNodes[1];
                arrow.classList.toggle('rotate');
                var content = this.nextElementSibling;
                content.classList.toggle('hide');
              });
            }

            document.addEventListener('DOMContentLoaded', function() {
              createToggler('#navToggler', '#docsNav', 'docsSliderActive');
              createToggler('#tocToggler', 'body', 'tocActive');

              var headings = document.querySelector('.toc-headings');
              headings && headings.addEventListener('click', function(event) {
                var el = event.target;
                while(el !== headings){
                  if (el.tagName === 'A') {
                    document.body.classList.remove('tocActive');
                    break;
                  } else{
                    el = el.parentNode;
                  }
                }
              }, false);

              function createToggler(togglerSelector, targetSelector, className) {
                var toggler = document.querySelector(togglerSelector);
                var target = document.querySelector(targetSelector);

                if (!toggler) {
                  return;
                }

                toggler.onclick = function(event) {
                  event.preventDefault();

                  target.classList.toggle(className);
                };
              }
            });
        </script></nav></div><div class="container mainContainer docsContainer"><div class="wrapper"><div class="post"><header class="postHeader"><h1 id="__docusaurus" class="postHeaderTitle">Serializers and Deserializers</h1></header><article><div><span><p>Serializers and deserializers are <a href="handers">handlers</a> but they have a specific mission. Serializers transform the
<a href="response">response</a> body into <a href="response">response</a> content. Deserializers transform the <a href="request">request</a> content
into the <a href="request">request</a> body. The returned or resolved value of each is set to the <a href="response">response</a> content
and <a href="request">request</a> body respectively. Because they are <a href="handlers">handlers</a>, they can be asynchronous and produce
errors in the same ways as other <a href="plugins">plugins</a>.</p>
<p>See <a href="https://www.npmjs.com/package/serviceberry-json"><code>serviceberry-json</code></a> for an example.</p>
<h2><a class="anchor" aria-hidden="true" id="plugins"></a><a href="#plugins" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Plugins</h2>
<p>Because serializers and deserializers have such a focused mission, they are a natural fit for being published as plugins.
Serviceberry loads a <a href="https://www.npmjs.com/package/serviceberry-json">JSON</a> serializer plugin by default and
<a href="https://www.npmjs.com/package/serviceberry-json">JSON</a> and <a href="https://www.npmjs.com/package/serviceberry-form">form</a>
deserializers plugins by default. If a request has a content type of <code>application/json</code> or <code>application/x-www-form-urlencoded</code>,
its body will automatically be deserialized and if a response has a content type of <code>application/json</code> its body will
automatically be serialized. All other serializers you will install and load with your service. The default serializer
and deserializers can be overridden at any node in the <a href="service-tree">service tree</a> - see <a href="#configuration">Configuration</a>
below.</p>
<h2><a class="anchor" aria-hidden="true" id="configuration"></a><a href="#configuration" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Configuration</h2>
<p>Serializer and deserializer <a href="handlers">handlers</a> are configured by content type as part of the options passed to
<a href="serviceberry#createtrunkoptions"><code>createTrunk([options])</code></a>, <a href="trunk#onoptions-handlers"><code>trunk.on(options, ...handlers)</code></a>,
<a href="branch#onoptions-handlers"><code>branch.on(options, ...handlers)</code></a>. <a href="request">Request</a> and <a href="response">response</a> content type
headers are use to find the right serializer and deserializer to use. If no serializer or deserializer is found for the
content type, serialization is skipped. This allows <code>text/plain</code> and binary content types to pass through unaltered
without needing serializers or deserializers configured.</p>
<p>For example, a naive CSV serialization plugin could be implemented with the following module.</p>
<pre><code class="hljs css language-javascript"><span class="hljs-built_in">module</span>.exports = {
    <span class="hljs-attr">contentType</span>: <span class="hljs-string">"text/csv"</span>,

    deserialize (request) {
        <span class="hljs-keyword">return</span> request.getContent().split(<span class="hljs-string">"\n"</span>).map(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row.split(<span class="hljs-string">","</span>));
    },

    serialize (request, response) {
        <span class="hljs-keyword">return</span> response.getBody().map(<span class="hljs-function"><span class="hljs-params">row</span> =&gt;</span> row.join(<span class="hljs-string">","</span>)).join(<span class="hljs-string">"\n"</span>);
    }
};
</code></pre>
<p>And can be configured at the <a href="trunk">trunk</a> with the following service code.</p>
<pre><code class="hljs css language-javascript"><span class="hljs-keyword">const</span> {createTrunk} = <span class="hljs-built_in">require</span>(<span class="hljs-string">"serviceberry"</span>),
    csv = <span class="hljs-built_in">require</span>(<span class="hljs-string">"csv"</span>); <span class="hljs-comment">// above module</span>

createTrunk({
    ...

    deserializers: {
        [csv.contentType]: csv.deserialize
    },

    <span class="hljs-attr">serializers</span>: {
        [csv.contentType]: csv.serialize
    }
});

...
</code></pre>
<p>Any leaf in this service which consumes or produces <code>text/csv</code> would be deserialized and serialized by the example
<a href="handlers">handlers</a>.</p>
<h2><a class="anchor" aria-hidden="true" id="caveats"></a><a href="#caveats" aria-hidden="true" class="hash-link"><svg class="hash-link-icon" aria-hidden="true" height="16" version="1.1" viewBox="0 0 16 16" width="16"><path fill-rule="evenodd" d="M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z"></path></svg></a>Caveats</h2>
<p><strong><em>Serializers and deserializers <a href="handlers">handlers</a> receive a <a href="response">response</a> object without a <code>send</code> method.
You cannot call <code>response.send()</code> from within a serializer or deserializer. Their only objective is to transform request
and response content or error if they are unable. They are not meant to control the request and response in other ways.</em></strong></p>
<p>One other technical detail about deserializers is they are executed prior to any <a href="handlers">handlers</a>
in the queue but their <em>result</em> is not immediate. This is unlikely to be an issue but differs from other <a href="handlers">handlers</a>.
If a deserializer results in an error, the error will only surface if and when <code>request.getBody()</code> is called from a
<a href="handlers">handler</a>. This allows deserializer <a href="plugins">plugins</a> to be asynchronous and deserializing error handling to
be more intuitive because <code>request.getBody()</code> is synchronous.</p>
<p>To learn how requests are routed through a <a href="service-tree">service tree</a>, checkout the <a href="service-tree">next guide</a>.</p>
</span></div></article></div><div class="docs-prevnext"><a class="docs-prev button" href="/docs/plugins"><span class="arrow-prev">← </span><span>Plugins</span></a><a class="docs-next button" href="/docs/service-tree"><span>Service Tree</span><span class="arrow-next"> →</span></a></div></div></div><nav class="onPageNav"><ul class="toc-headings"><li><a href="#plugins">Plugins</a></li><li><a href="#configuration">Configuration</a></li><li><a href="#caveats">Caveats</a></li></ul></nav></div><footer class="nav-footer" id="footer"><section class="sitemap"><a href="/" class="nav-home"></a><div><h5>Guides</h5><a href="/docs/getting-started">Getting Started</a><a href="/docs/handlers">Handlers</a><a href="/docs/plugins">Plugins</a><a href="/docs/serializers-and-deserializers">Serializers and Deserializers</a><a href="/docs/service-tree">Serice Tree</a><a href="/docs/auto-responses">Auto Responses</a><a href="/docs/how-it-works">How it Works</a></div><div><h5>API Reference</h5><a href="/docs/serviceberry">Serviceberry</a><a href="/docs/trunk">Trunk</a><a href="/docs/branch">Branch</a><a href="/docs/leaf">Leaf</a><a href="/docs/request">Reqeust</a><a href="/docs/response">Response</a><a href="/docs/httperror">HttpError</a></div><div><h5>More</h5><a href="/blog">Blog</a><a class="github-link" href="https://github.com/bob-gray/serviceberry">GitHub</a><a class="github-button" href="https://github.com/bob-gray/serviceberry" data-icon="octicon-star" data-count-href="/facebook/docusaurus/stargazers" data-show-count="true" data-count-aria-label="# stargazers on GitHub" aria-label="Star this project on GitHub">Star</a><a href="/docs/contributing">Contributing</a><a href="/docs/license">License</a></div></section></footer></div><script type="text/javascript" src="https://cdn.jsdelivr.net/docsearch.js/1/docsearch.min.js"></script><script>window.twttr=(function(d,s, id){var js,fjs=d.getElementsByTagName(s)[0],t=window.twttr||{};if(d.getElementById(id))return t;js=d.createElement(s);js.id=id;js.src='https://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js, fjs);t._e = [];t.ready = function(f) {t._e.push(f);};return t;}(document, 'script', 'twitter-wjs'));</script><script>
                document.addEventListener('keyup', function(e) {
                  if (e.target !== document.body) {
                    return;
                  }
                  // keyCode for '/' (slash)
                  if (e.keyCode === 191) {
                    const search = document.getElementById('search_input_react');
                    search && search.focus();
                  }
                });
              </script><script>
              var search = docsearch({
                
                apiKey: 'd8f71d3fca61a88437ddb93081120da2',
                indexName: 'serviceberry',
                inputSelector: '#search_input_react'
              });
            </script></body></html>